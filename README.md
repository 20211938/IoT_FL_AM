# FLAM í”„ë¡œì íŠ¸ ì½”ë“œ ë¶„ì„ (ì „ì²´ Python íŒŒì¼ í¬í•¨)

## ğŸ¯ ì´ í”„ë¡œì íŠ¸ê°€ í•˜ëŠ” ì¼

**3D í”„ë¦°íŒ… ê³¼ì •ì—ì„œ ê²°í•¨ì„ ì°¾ëŠ” AI ëª¨ë¸**ì„ ë§Œë“œëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.
- ì—¬ëŸ¬ ê³µì¥(í´ë¼ì´ì–¸íŠ¸)ì˜ ë°ì´í„°ë¥¼ ëª¨ìœ¼ì§€ ì•Šê³ ë„ í•¨ê»˜ í•™ìŠµí•˜ëŠ” **ì—°í•© í•™ìŠµ(Federated Learning)** ë°©ì‹ ì‚¬ìš©
- ê° í”½ì…€ì„ 3ê°€ì§€ë¡œ ë¶„ë¥˜: **íŒŒìš°ë”(0) / ë¶€í’ˆ(1) / ê²°í•¨(2)**
- MongoDBì—ì„œ ë ˆì´ë¸”ëœ ë ˆì´ì–´ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ í•™ìŠµ ë°ì´í„°ë¡œ í™œìš©

---

## ğŸ“ íŒŒì¼ êµ¬ì¡° ë° ì—­í• 

```
FLAM/
â”œâ”€â”€ Federated_learning.ipynb          # ë©”ì¸ ë…¸íŠ¸ë¶ (ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ image_processing.py           # ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ë° íƒ€ì¼ë§
â”‚   â”œâ”€â”€ dataset_functions.py          # ë°ì´í„°ì…‹ ìƒì„± ë° ê´€ë¦¬
â”‚   â”œâ”€â”€ unet.py                       # U-Net ëª¨ë¸ ì •ì˜
â”‚   â”œâ”€â”€ federated_averaging.py        # FedAvg ì—°í•© í•™ìŠµ ì•Œê³ ë¦¬ì¦˜
â”‚   â”œâ”€â”€ visualization.py              # ê²°ê³¼ ì‹œê°í™” ë° í‰ê°€
â”‚   â”œâ”€â”€ CNN/
â”‚   â”‚   â”œâ”€â”€ defect_type_classifier.py     # ê²°í•¨ ìœ í˜• ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ
â”‚   â”‚   â”œâ”€â”€ test_defect_type_classifier.py # ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ í…ŒìŠ¤íŠ¸
â”‚   â”‚   â””â”€â”€ test_results_analysis.md      # í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„
â”‚   â”œâ”€â”€ AprilGAN/
â”‚   â”‚   â”œâ”€â”€ zero_shot_defect_classifier.py # ì œë¡œìƒ· ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸
â”‚   â”‚   â””â”€â”€ test_zero_shot_classifier.py   # ì œë¡œìƒ· ëª¨ë¸ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ Dataset/
â”‚       â”œâ”€â”€ download_labeled_layers.py    # MongoDBì—ì„œ ë ˆì´ë¸”ëœ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
â”‚       â”œâ”€â”€ cleanup_dataset.py            # ë°ì´í„°ì…‹ ì •ë¦¬ ë° ì†Œìˆ˜ í´ë˜ìŠ¤ ì œê±°
â”‚       â”œâ”€â”€ analyze_defect_types.py       # ê²°í•¨ ìœ í˜• ë¶„ì„
â”‚       â””â”€â”€ dataset_info.md               # ë°ì´í„°ì…‹ ì •ë³´ ë¬¸ì„œ
â””â”€â”€ data/                             # ì´ë¯¸ì§€ ë°ì´í„° ì €ì¥ì†Œ
    â””â”€â”€ labeled_layers/               # ë‹¤ìš´ë¡œë“œëœ ë ˆì´ë¸”ëœ ì´ë¯¸ì§€
```

---

## ğŸ“ ê° íŒŒì¼ ìƒì„¸ ë¶„ì„

### 1. `utils/image_processing.py` - ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ë° íƒ€ì¼ë§

**ì—­í• **: í° ì´ë¯¸ì§€ë¥¼ ì‘ì€ íƒ€ì¼ë¡œ ë‚˜ëˆ„ê³ , íƒ€ì¼ì„ ë‹¤ì‹œ í•©ì¹˜ëŠ” ê¸°ëŠ¥ ì œê³µ

### 2. `utils/dataset_functions.py` - ë°ì´í„°ì…‹ ìƒì„± ë° ê´€ë¦¬

**ì—­í• **: í´ë¼ì´ì–¸íŠ¸ë³„ ë°ì´í„°ì…‹ ìƒì„± ë° ë°ì´í„° ê²°í•©

### 3. `utils/unet.py` - U-Net ëª¨ë¸ ì •ì˜

**ì—­í• **: U-Net ì•„í‚¤í…ì²˜ ëª¨ë¸ ìƒì„± ë° ì»´íŒŒì¼

### 4. `utils/federated_averaging.py` - ì—°í•© í•™ìŠµ ì•Œê³ ë¦¬ì¦˜

**ì—­í• **: FedAvg ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„ - ê° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¡œì»¬ í•™ìŠµ í›„ ì„œë²„ì—ì„œ ê°€ì¤‘ì¹˜ í‰ê· 

#### ì•Œê³ ë¦¬ì¦˜ ë™ì‘ ê³¼ì •

```
1. ì´ˆê¸°í™”
   - ê° í´ë¼ì´ì–¸íŠ¸ì˜ ë°ì´í„° ê°œìˆ˜ ê³„ì‚°
   - ê°€ì¤‘ í‰ê· ì„ ìœ„í•œ ë¹„ìœ¨ ê³„ì‚° (proportionsDict)
   - ì„œë²„ ê°€ì¤‘ì¹˜ ì´ˆê¸°í™”

2. ê° ì„œë²„ ë¼ìš´ë“œë§ˆë‹¤:
   
   a) í´ë¼ì´ì–¸íŠ¸ ì—…ë°ì´íŠ¸ (ë¡œì»¬ í•™ìŠµ)
      - ê° í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•´:
        1. ê¸€ë¡œë²Œ ëª¨ë¸ ë³µì œ
        2. ì„œë²„ ê°€ì¤‘ì¹˜ë¡œ ì´ˆê¸°í™”
        3. ë¡œì»¬ ë°ì´í„°ë¡œ LOCAL_EPOCHSë§Œí¼ í•™ìŠµ
        4. í•™ìŠµëœ ê°€ì¤‘ì¹˜ ì €ì¥
        5. ì†ì‹¤/ì •í™•ë„ ê¸°ë¡
   
   b) ì„œë²„ ì—…ë°ì´íŠ¸ (ê°€ì¤‘ì¹˜ í‰ê· )
      - ê° í´ë¼ì´ì–¸íŠ¸ì˜ ê°€ì¤‘ì¹˜ë¥¼ ë°ì´í„° ë¹„ìœ¨ë¡œ ê°€ì¤‘ í‰ê· 
      - ê³µì‹: w_global = Î£(n_k / N) * w_k
        - n_k: í´ë¼ì´ì–¸íŠ¸ kì˜ ë°ì´í„° ê°œìˆ˜
        - N: ì „ì²´ ë°ì´í„° ê°œìˆ˜
        - w_k: í´ë¼ì´ì–¸íŠ¸ kì˜ ê°€ì¤‘ì¹˜
   
   c) ê¸€ë¡œë²Œ ëª¨ë¸ ì—…ë°ì´íŠ¸
      - í‰ê· ëœ ê°€ì¤‘ì¹˜ë¥¼ ê¸€ë¡œë²Œ ëª¨ë¸ì— ì ìš©
   
   d) í…ŒìŠ¤íŠ¸ í‰ê°€
      - í…ŒìŠ¤íŠ¸ì…‹ìœ¼ë¡œ ì„±ëŠ¥ í‰ê°€
      - í…ŒìŠ¤íŠ¸ ì†ì‹¤/ì •í™•ë„ ê¸°ë¡

3. ë°˜í™˜
   - í•™ìŠµëœ ëª¨ë¸ ë° ëª¨ë“  ê¸°ë¡ ë°˜í™˜
```

#### ê°€ì¤‘ í‰ê·  ì˜ˆì‹œ

```python
# í´ë¼ì´ì–¸íŠ¸ë³„ ë°ì´í„° ê°œìˆ˜
client1: 1000ê°œ â†’ ë¹„ìœ¨ 0.5
client2: 500ê°œ  â†’ ë¹„ìœ¨ 0.25
client3: 500ê°œ  â†’ ë¹„ìœ¨ 0.25

# ê°€ì¤‘ í‰ê· 
w_global = 0.5 * w_client1 + 0.25 * w_client2 + 0.25 * w_client3
```

---

### 5. `utils/visualization.py` - ê²°ê³¼ ì‹œê°í™” ë° í‰ê°€

**ì—­í• **: í•™ìŠµëœ ëª¨ë¸ì˜ ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™” ë° ì„±ëŠ¥ í‰ê°€

### 6. `utils/Dataset/download_labeled_layers.py` - MongoDB ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ

**ì—­í• **: MongoDB GridFSì—ì„œ ë ˆì´ë¸”ëœ ë ˆì´ì–´ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œ

**ì£¼ìš” ê¸°ëŠ¥**:
- MongoDB ì—°ê²° ë° ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ ì¡°íšŒ
- `IsLabeled=True`ì¸ ë ˆì´ì–´ë§Œ í•„í„°ë§
- GridFSì—ì„œ ì´ë¯¸ì§€ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
- ë©”íƒ€ë°ì´í„° JSON íŒŒì¼ ì €ì¥ (ì„ íƒì‚¬í•­)
- ì „ì²´ ë‹¤ìš´ë¡œë“œ ì œí•œ ì„¤ì • (ê¸°ë³¸ê°’: 10,000ê°œ)

### 7. `utils/Dataset/cleanup_dataset.py` - ë°ì´í„°ì…‹ ì •ë¦¬

**ì—­í• **: ë‹¤ìš´ë¡œë“œëœ ë°ì´í„°ì…‹ì—ì„œ ì†Œìˆ˜ í´ë˜ìŠ¤ ë° ì˜ë¯¸ ì—†ëŠ” ì´ë¦„ ì œê±°

**ì£¼ìš” ê¸°ëŠ¥**:
- ê²°í•¨ ìœ í˜•ë³„ í†µê³„ ìˆ˜ì§‘
- ë¹„ìœ¨ ê¸°ë°˜ í•„í„°ë§ (ê¸°ë³¸ê°’: 1% ë¯¸ë§Œ ì œê±°)
- ì˜ë¯¸ ì—†ëŠ” ì´ë¦„ ê°ì§€ ë° ì œê±° (ìˆ«ìë§Œ, D1/D2 íŒ¨í„´, 2ì ì´í•˜)
- DRY RUN ëª¨ë“œ ì§€ì›

### 8. `utils/CNN/defect_type_classifier.py` - ê²°í•¨ ìœ í˜• ë¶„ë¥˜ ëª¨ë¸

**ì—­í• **: íŠ¹ì • ê²°í•¨ ìœ í˜•ì„ ë¶„ë¥˜í•˜ëŠ” CNN ëª¨ë¸ í•™ìŠµ

**ì£¼ìš” ê¸°ëŠ¥**:
- ë©”íƒ€ë°ì´í„°ì—ì„œ ê²°í•¨ ìœ í˜• ì¶”ì¶œ
- CNN ê¸°ë°˜ ë‹¤ì¤‘ í´ë˜ìŠ¤ ë¶„ë¥˜ ëª¨ë¸
- í•™ìŠµ/ê²€ì¦ ë°ì´í„° ë¶„í• 
- ì²´í¬í¬ì¸íŠ¸ ì €ì¥ ë° ìµœì  ëª¨ë¸ ì„ íƒ

### 9. `utils/AprilGAN/zero_shot_defect_classifier.py` - ì œë¡œìƒ· ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸

**ì—­í• **: AprilGAN ê¸°ë°˜ ì œë¡œìƒ· ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸

**ì£¼ìš” ê¸°ëŠ¥**:
- GAN ê¸°ë°˜ ì´ìƒ íƒì§€
- ì „ì²˜ë¦¬ ì—†ì´ ê²°í•¨ ë¶„ë¥˜
- ì œë¡œìƒ· í•™ìŠµ ì§€ì›

---

## ğŸš€ ì „ì²´ ì‹¤í–‰ ê³¼ì • (ê¸°ë³¸ ì„¤ì •)

í”„ë¡œì íŠ¸ë¥¼ ì²˜ìŒë¶€í„° ì‹¤í–‰í•˜ëŠ” ì „ì²´ ê³¼ì •ì…ë‹ˆë‹¤. ëª¨ë“  ëª…ë ¹ì–´ëŠ” ê¸°ë³¸ ì„¤ì •ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 1ë‹¨ê³„: ë°ì´í„° ë‹¤ìš´ë¡œë“œ

MongoDBì—ì„œ ë ˆì´ë¸”ëœ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤ (ìµœëŒ€ 10,000ê°œ).

```bash
python utils/Dataset/download_labeled_layers.py --metadata
```

**ê²°ê³¼**: `data/labeled_layers/` ë””ë ‰í† ë¦¬ì— ì´ë¯¸ì§€ íŒŒì¼ê³¼ ë©”íƒ€ë°ì´í„° JSON íŒŒì¼ì´ ì €ì¥ë©ë‹ˆë‹¤.

### 2ë‹¨ê³„: ë°ì´í„°ì…‹ ì •ë¦¬

ë‹¤ìš´ë¡œë“œëœ ë°ì´í„°ì—ì„œ ì†Œìˆ˜ í´ë˜ìŠ¤(1% ë¯¸ë§Œ) ë° ì˜ë¯¸ ì—†ëŠ” ì´ë¦„ì„ ì œê±°í•©ë‹ˆë‹¤.

```bash
python utils/Dataset/cleanup_dataset.py --data-dir data/labeled_layers
```

**ê²°ê³¼**: í•™ìŠµì— ì í•©í•œ ë°ì´í„°ë§Œ ë‚¨ê²Œ ë©ë‹ˆë‹¤.

### 3ë‹¨ê³„: ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ

ì •ë¦¬ëœ ë°ì´í„°ë¡œ ê²°í•¨ ìœ í˜• ë¶„ë¥˜ ëª¨ë¸ì„ í•™ìŠµí•©ë‹ˆë‹¤.

```bash
python utils/CNN/defect_type_classifier.py --data-dir data/labeled_layers
```

**ê²°ê³¼**: `checkpoints/` ë””ë ‰í† ë¦¬ì— ìµœì  ëª¨ë¸ì´ ì €ì¥ë©ë‹ˆë‹¤.

### 4ë‹¨ê³„: ëª¨ë¸ í…ŒìŠ¤íŠ¸

í•™ìŠµëœ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.

```bash
python utils/CNN/test_defect_type_classifier.py \
    --checkpoint checkpoints/best_model.pth \
    --data-dir data/labeled_layers
```

**ê²°ê³¼**: ì •í™•ë„, í˜¼ë™ í–‰ë ¬ ë“± í‰ê°€ ê²°ê³¼ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

---

## ğŸ” U-Netì„ ì´ìš©í•œ í”½ì…€ ë‹¨ìœ„ ê²°í•¨ íƒì§€ (ìš”ì•½)

### ê°œìš”

U-Net ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ì˜ ê° í”½ì…€ì„ 3ê°€ì§€ í´ë˜ìŠ¤ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤:
- **íŒŒìš°ë” (0)**: íŒŒìš°ë” ì˜ì—­
- **ë¶€í’ˆ (1)**: ì •ìƒ ë¶€í’ˆ ì˜ì—­
- **ê²°í•¨ (2)**: ê²°í•¨ ì˜ì—­

### ì£¼ìš” íŠ¹ì§•

- **ì—°í•© í•™ìŠµ (Federated Learning)**: ì—¬ëŸ¬ ê³µì¥ì˜ ë°ì´í„°ë¥¼ ëª¨ìœ¼ì§€ ì•Šê³ ë„ í•¨ê»˜ í•™ìŠµ
- **í”½ì…€ ë‹¨ìœ„ ë¶„í• **: ì´ë¯¸ì§€ì˜ ê° í”½ì…€ì„ ê°œë³„ì ìœ¼ë¡œ ë¶„ë¥˜
- **íƒ€ì¼ë§**: í° ì´ë¯¸ì§€ë¥¼ 128Ã—128 íƒ€ì¼ë¡œ ë¶„í• í•˜ì—¬ ì²˜ë¦¬
- **8ê°œ í´ë¼ì´ì–¸íŠ¸**: 7ê°œ ê³µì¥ì—ì„œ í•™ìŠµ, 1ê°œ ê³µì¥ìœ¼ë¡œ í…ŒìŠ¤íŠ¸

### ì‹¤í–‰ ë°©ë²•

```python
# Jupyter Notebookì—ì„œ ì‹¤í–‰
# Federated_learning.ipynb íŒŒì¼ ì°¸ì¡°
```

### í•˜ì´í¼íŒŒë¼ë¯¸í„°

```python
SERVER_ROUNDS = 2                 # ì„œë²„ ë¼ìš´ë“œ ìˆ˜
LOCAL_EPOCHS = 5                  # í´ë¼ì´ì–¸íŠ¸ë‹¹ ë¡œì»¬ ì—í¬í¬
LOCAL_BATCH_SIZE = 32             # ë°°ì¹˜ í¬ê¸°
LOCAL_LEARNING_RATE = 8e-05       # ë¡œì»¬ í•™ìŠµë¥ 
tileSize = 128                    # íƒ€ì¼ í¬ê¸°
```

### ì•Œê³ ë¦¬ì¦˜ ë™ì‘

1. ê° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¡œì»¬ í•™ìŠµ ìˆ˜í–‰
2. ì„œë²„ì—ì„œ ê°€ì¤‘ì¹˜ë¥¼ ë°ì´í„° ë¹„ìœ¨ë¡œ ê°€ì¤‘ í‰ê· 
3. ê¸€ë¡œë²Œ ëª¨ë¸ ì—…ë°ì´íŠ¸
4. ë°˜ë³µ (SERVER_ROUNDSë§Œí¼)

---

## ğŸ“ ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ ìƒì„¸ ì„¤ëª…

### ê°œìš”

ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ì€ ì´ë¯¸ì§€ ì „ì²´ë¥¼ ì…ë ¥ë°›ì•„ **ì–´ë–¤ ì¢…ë¥˜ì˜ ê²°í•¨ì¸ì§€**ë¥¼ ë¶„ë¥˜í•˜ëŠ” CNN ê¸°ë°˜ ë‹¤ì¤‘ í´ë˜ìŠ¤ ë¶„ë¥˜ ëª¨ë¸ì…ë‹ˆë‹¤. U-Netê³¼ ë‹¬ë¦¬ í”½ì…€ ë‹¨ìœ„ê°€ ì•„ë‹Œ ì´ë¯¸ì§€ ë‹¨ìœ„ë¡œ ê²°í•¨ ìœ í˜•ì„ íŒë‹¨í•©ë‹ˆë‹¤.

### ë°ì´í„°ì…‹ êµ¬ì¡°

#### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
data/labeled_layers/
â”œâ”€â”€ {database_name}/              # ë°ì´í„°ë² ì´ìŠ¤ë³„ ë””ë ‰í† ë¦¬
â”‚   â”œâ”€â”€ {db_name}_layer{num}_{id}.jpg      # ì´ë¯¸ì§€ íŒŒì¼
â”‚   â”œâ”€â”€ {db_name}_layer{num}_{id}.jpg.json # ë©”íƒ€ë°ì´í„° íŒŒì¼
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

#### íŒŒì¼ í˜•ì‹

- **ì´ë¯¸ì§€ íŒŒì¼**: `.jpg` í˜•ì‹ì˜ ë ˆì´ì–´ ì´ë¯¸ì§€
- **ë©”íƒ€ë°ì´í„° íŒŒì¼**: `.jpg.json` í˜•ì‹ì˜ JSON íŒŒì¼
  - ê° ì´ë¯¸ì§€ì— ëŒ€ì‘í•˜ëŠ” ë©”íƒ€ë°ì´í„°
  - ê²°í•¨ ìœ í˜• ì •ë³´ í¬í•¨

#### ë©”íƒ€ë°ì´í„° êµ¬ì¡°

ë©”íƒ€ë°ì´í„° JSON íŒŒì¼ì—ëŠ” ë‹¤ìŒ ì •ë³´ê°€ í¬í•¨ë©ë‹ˆë‹¤:

```json
{
  "DepositionImageModel": {
    "TagBoxes": [
      {
        "Name": "D1",
        "Comment": "Super Elevation"
      }
    ]
  },
  "ScanningImageModel": {
    "TagBoxes": [
      {
        "Name": "D2",
        "Comment": "Recoater Streaking"
      }
    ]
  }
}
```

- `DepositionImageModel.TagBoxes`: Deposition ì´ë¯¸ì§€ì˜ ê²°í•¨ íƒœê·¸
- `ScanningImageModel.TagBoxes`: Scanning ì´ë¯¸ì§€ì˜ ê²°í•¨ íƒœê·¸
- ê° íƒœê·¸ì˜ `Comment` í•„ë“œê°€ ê²°í•¨ ìœ í˜•ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤ (ì—†ìœ¼ë©´ `Name` ì‚¬ìš©)

### ê²°í•¨ ì¢…ë¥˜ (Defect Types)

í˜„ì¬ ë°ì´í„°ì…‹ì—ëŠ” **6ê°€ì§€ ê²°í•¨ ìœ í˜•**ì´ ìˆìŠµë‹ˆë‹¤:

| ìˆœìœ„ | ê²°í•¨ ìœ í˜• | ìƒ˜í”Œ ìˆ˜ | ë¹„ìœ¨ | ì„¤ëª… |
|------|----------|--------|------|------|
| 1 | **Super Elevation** | 4,819ê°œ | 41.1% | í‘œë©´ì´ ì •ìƒë³´ë‹¤ ë†’ê²Œ ì†Ÿì•„ì˜¤ë¥¸ ê²°í•¨ |
| 2 | **Recoater Streaking** | 3,746ê°œ | 31.9% | Recoaterë¡œ ì¸í•œ ìŠ¤íŠ¸ë¦¬í‚¹ ê²°í•¨ |
| 3 | **Fail** | 1,141ê°œ | 9.7% | ì¼ë°˜ì ì¸ ì‹¤íŒ¨ ì¼€ì´ìŠ¤ |
| 4 | **Laser capture timing error** | 1,089ê°œ | 9.3% | ë ˆì´ì € ìº¡ì²˜ íƒ€ì´ë° ì˜¤ë¥˜ |
| 5 | **Reocater Streaking** | 615ê°œ | 5.2% | Recoater ê´€ë ¨ ìŠ¤íŠ¸ë¦¬í‚¹ ê²°í•¨ (Recoaterì™€ ë‹¤ë¥¸ ìœ í˜•) |
| 6 | **Recoater capture timing error** | 309ê°œ | 2.6% | Recoater ìº¡ì²˜ íƒ€ì´ë° ì˜¤ë¥˜ |

**ì°¸ê³ ì‚¬í•­**:
- `Recoater Streaking`ê³¼ `Reocater Streaking`ì€ ì„œë¡œ ë‹¤ë¥¸ í´ë˜ìŠ¤ì…ë‹ˆë‹¤ (ì˜¤íƒ€ê°€ ì•„ë‹™ë‹ˆë‹¤)
- ì¼ë¶€ ì´ë¯¸ì§€ëŠ” ì—¬ëŸ¬ ê²°í•¨ ìœ í˜•ì„ ë™ì‹œì— ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ì´ ìƒ˜í”Œ ìˆ˜(11,719ê°œ)ê°€ íŒŒì¼ ìˆ˜(9,665ê°œ)ë³´ë‹¤ ë§ì€ ì´ìœ ëŠ” í•˜ë‚˜ì˜ ì´ë¯¸ì§€ê°€ ì—¬ëŸ¬ ê²°í•¨ ìœ í˜•ì„ í¬í•¨í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤

### ë°ì´í„°ì…‹ í†µê³„

- **ì „ì²´ íŒŒì¼ ìˆ˜**: 9,665ê°œ
- **ê²°í•¨ ìœ í˜• ìˆ˜**: 6ê°œ
- **ì´ ìƒ˜í”Œ ìˆ˜**: 11,719ê°œ (ì¤‘ë³µ í¬í•¨)
- **í´ë˜ìŠ¤ ë¶ˆê· í˜• ë¹„ìœ¨**: ì•½ 15.6:1 (Super Elevation vs Recoater capture timing error)

### ëª¨ë¸ êµ¬ì¡°

```
ì…ë ¥: ì´ë¯¸ì§€ (224Ã—224Ã—3)
  â†“
CNN ë ˆì´ì–´
  â”œâ”€ Conv2D + BatchNorm + ReLU
  â”œâ”€ MaxPooling
  â”œâ”€ Conv2D + BatchNorm + ReLU
  â”œâ”€ MaxPooling
  â””â”€ ...
  â†“
Fully Connected ë ˆì´ì–´
  â†“
Softmax
  â†“
ì¶œë ¥: ê²°í•¨ ìœ í˜• í´ë˜ìŠ¤ í™•ë¥  (6ê°œ í´ë˜ìŠ¤)
```

### í•™ìŠµ ê³¼ì •

1. **ë©”íƒ€ë°ì´í„° íŒŒì‹±**: JSON íŒŒì¼ì—ì„œ ê²°í•¨ ìœ í˜• ì¶”ì¶œ
2. **ë°ì´í„° í•„í„°ë§**: ìµœì†Œ ìƒ˜í”Œ ìˆ˜ ë¯¸ë§Œì¸ í´ë˜ìŠ¤ ì œê±° (ê¸°ë³¸ê°’: 10ê°œ)
3. **ë°ì´í„° ë¶„í• **: í•™ìŠµ 80% / ê²€ì¦ 20%
4. **ëª¨ë¸ ì´ˆê¸°í™”**: CNN ëª¨ë¸ ìƒì„±
5. **í•™ìŠµ**: Adam ì˜µí‹°ë§ˆì´ì €ë¡œ í•™ìŠµ
6. **ê²€ì¦**: ê° ì—í¬í¬ë§ˆë‹¤ ê²€ì¦ ì •í™•ë„ í™•ì¸
7. **ì²´í¬í¬ì¸íŠ¸ ì €ì¥**: ìµœê³  ì„±ëŠ¥ ëª¨ë¸ ì €ì¥

### ê¸°ë³¸ í•˜ì´í¼íŒŒë¼ë¯¸í„°

```python
epochs = 20              # í•™ìŠµ ì—í¬í¬ ìˆ˜
batch_size = 16         # ë°°ì¹˜ í¬ê¸°
learning_rate = 0.001   # í•™ìŠµë¥ 
min_count = 10          # ìµœì†Œ ìƒ˜í”Œ ìˆ˜ (ì´ë³´ë‹¤ ì ìœ¼ë©´ í´ë˜ìŠ¤ ì œê±°)
```

### ì‹¤í–‰ ëª…ë ¹ì–´

```bash
# ê¸°ë³¸ ì‚¬ìš©
python utils/CNN/defect_type_classifier.py --data-dir data/labeled_layers

# ëª¨ë¸ í…ŒìŠ¤íŠ¸
python utils/CNN/test_defect_type_classifier.py \
    --checkpoint checkpoints/best_model.pth \
    --data-dir data/labeled_layers
```

### í‰ê°€ ì§€í‘œ

- **ì „ì²´ ì •í™•ë„**: ì „ì²´ ì˜ˆì¸¡ ì¤‘ ì •í™•í•œ ì˜ˆì¸¡ ë¹„ìœ¨
- **í´ë˜ìŠ¤ë³„ ì •í™•ë„**: ê° ê²°í•¨ ìœ í˜•ë³„ ì •í™•ë„
- **í˜¼ë™ í–‰ë ¬**: í´ë˜ìŠ¤ ê°„ ì˜¤ë¶„ë¥˜ íŒ¨í„´ ë¶„ì„

---

## ğŸ”„ ì „ì²´ ì›Œí¬í”Œë¡œìš°

### A. ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ ì›Œí¬í”Œë¡œìš° (ìƒˆë¡œìš´ ë°©ì‹)

```
1. ë°ì´í„° ë‹¤ìš´ë¡œë“œ
   â””â”€ utils/Dataset/download_labeled_layers.py: MongoDBì—ì„œ ë ˆì´ë¸”ëœ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ (ìµœëŒ€ 10,000ê°œ)
   
2. ë°ì´í„°ì…‹ ì •ë¦¬
   â””â”€ utils/Dataset/cleanup_dataset.py: ì†Œìˆ˜ í´ë˜ìŠ¤ ë° ì˜ë¯¸ ì—†ëŠ” ì´ë¦„ ì œê±°
      â”œâ”€ ë¹„ìœ¨ ê¸°ë°˜ í•„í„°ë§ (1% ë¯¸ë§Œ)
      â”œâ”€ ì˜ë¯¸ ì—†ëŠ” ì´ë¦„ ì œê±° (ìˆ«ìë§Œ, D1/D2 íŒ¨í„´)
      â””â”€ ì •ë¦¬ëœ ë°ì´í„°ì…‹ ìƒì„±
   
3. ê²°í•¨ ìœ í˜• ë¶„ì„ (ì„ íƒì‚¬í•­)
   â””â”€ utils/Dataset/analyze_defect_types.py: ë°ì´í„°ì…‹ í†µê³„ ë° ë¶„í¬ ë¶„ì„
   
4. ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ
   â””â”€ utils/CNN/defect_type_classifier.py: CNN ê¸°ë°˜ ë‹¤ì¤‘ í´ë˜ìŠ¤ ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ
      â”œâ”€ ë©”íƒ€ë°ì´í„°ì—ì„œ ê²°í•¨ ìœ í˜• ì¶”ì¶œ
      â”œâ”€ í•™ìŠµ/ê²€ì¦ ë°ì´í„° ë¶„í• 
      â”œâ”€ CNN ëª¨ë¸ í•™ìŠµ
      â””â”€ ìµœì  ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ ì €ì¥
   
5. ëª¨ë¸ í…ŒìŠ¤íŠ¸
   â””â”€ utils/CNN/test_defect_type_classifier.py: í•™ìŠµëœ ëª¨ë¸ í‰ê°€
      â”œâ”€ ì •í™•ë„ ê³„ì‚°
      â”œâ”€ í˜¼ë™ í–‰ë ¬ ìƒì„±
      â””â”€ ì˜¤ë¶„ë¥˜ ë¶„ì„
```

### B. í”½ì…€ ë‹¨ìœ„ ê²°í•¨ íƒì§€ ì›Œí¬í”Œë¡œìš° (ê¸°ì¡´ ë°©ì‹)

```
1. ë°ì´í„° ì¤€ë¹„
   â””â”€ utils/Dataset/download_labeled_layers.py: MongoDBì—ì„œ ë ˆì´ë¸”ëœ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
   
2. ì´ë¯¸ì§€ ì „ì²˜ë¦¬
   â””â”€ image_processing.py: ì´ë¯¸ì§€ë¥¼ 128Ã—128 íƒ€ì¼ë¡œ ë¶„í• 
   
3. ë°ì´í„°ì…‹ ìƒì„±
   â””â”€ dataset_functions.py: í´ë¼ì´ì–¸íŠ¸ë³„ ë°ì´í„°ì…‹ ìƒì„±
   
4. ëª¨ë¸ ì´ˆê¸°í™”
   â””â”€ unet.py: U-Net ëª¨ë¸ ìƒì„± ë° ì»´íŒŒì¼
   
5. ì—°í•© í•™ìŠµ
   â””â”€ federated_averaging.py: FedAvg ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰
      â”œâ”€ ê° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¡œì»¬ í•™ìŠµ
      â”œâ”€ ì„œë²„ì—ì„œ ê°€ì¤‘ì¹˜ í‰ê· 
      â””â”€ ë°˜ë³µ
   
6. ê²°ê³¼ í‰ê°€ ë° ì‹œê°í™”
   â””â”€ visualization.py: ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™” ë° ì„±ëŠ¥ í‰ê°€
```

---

## ğŸ”‘ í•µì‹¬ ê°œë… ì •ë¦¬

| ê°œë… | ì„¤ëª… | ê´€ë ¨ íŒŒì¼ |
|------|------|----------|
| **íƒ€ì¼ë§** | í° ì´ë¯¸ì§€ë¥¼ 128Ã—128 ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆ„ê¸° | `image_processing.py` |
| **í´ë¼ì´ì–¸íŠ¸** | ê° ê³µì¥ (client1~client8) | `dataset_functions.py` |
| **ì—°í•© í•™ìŠµ** | ê° ê³µì¥ì—ì„œ ë”°ë¡œ í•™ìŠµ í›„ ì„œë²„ì—ì„œ í•©ì¹˜ê¸° | `federated_averaging.py` |
| **U-Net** | ì´ë¯¸ì§€ ë¶„í• ìš© ëª¨ë¸ (ì¸ì½”ë”-ë””ì½”ë” + Skip Connection) | `unet.py` |
| **3í´ë˜ìŠ¤** | íŒŒìš°ë”(0), ë¶€í’ˆ(1), ê²°í•¨(2) | ëª¨ë“  íŒŒì¼ |
| **GridFS** | MongoDBì˜ ëŒ€ìš©ëŸ‰ íŒŒì¼ ì €ì¥ ì‹œìŠ¤í…œ | `download_labeled_layers.py` |
| **MeanIoU** | í‰ê·  Intersection over Union (ì •í™•ë„ ì§€í‘œ) | `visualization.py` |

---

## ğŸ“Š ì£¼ìš” í•˜ì´í¼íŒŒë¼ë¯¸í„°

```python
# ëª¨ë¸ ì„¤ì •
tileSize = 128                    # íƒ€ì¼ í¬ê¸°
learning_rate = 0.0008            # ëª¨ë¸ ì´ˆê¸° í•™ìŠµë¥ 

# ì—°í•© í•™ìŠµ ì„¤ì •
SERVER_ROUNDS = 2                 # ì„œë²„ ë¼ìš´ë“œ ìˆ˜
LOCAL_EPOCHS = 5                  # í´ë¼ì´ì–¸íŠ¸ë‹¹ ë¡œì»¬ ì—í¬í¬
LOCAL_BATCH_SIZE = 32             # ë°°ì¹˜ í¬ê¸°
LOCAL_LEARNING_RATE = 8e-05       # ë¡œì»¬ í•™ìŠµë¥ 

```

---

## ğŸ”§ í™˜ê²½ ì„¤ì •

### ê°€ìƒ í™˜ê²½ í™œì„±í™” (Windows PowerShell)

PowerShellì—ì„œ ê°€ìƒ í™˜ê²½ì„ í™œì„±í™”í•  ë•Œ ì‹¤í–‰ ì •ì±… ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë°©ë²• ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

#### ë°©ë²• 1: í˜„ì¬ ì„¸ì…˜ì—ë§Œ ì‹¤í–‰ ì •ì±… ë³€ê²½ (ê¶Œì¥)

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process
.\venv311\Scripts\Activate.ps1
```

ë˜ëŠ” í•œ ì¤„ë¡œ ì‹¤í–‰:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process; .\venv311\Scripts\Activate.ps1
```

#### ë°©ë²• 2: activate.bat ì‚¬ìš©

```powershell
cmd /c "venv311\Scripts\activate.bat && powershell"
```

#### ë°©ë²• 3: Python ì§ì ‘ ì‹¤í–‰ (ê°€ì¥ ê°„ë‹¨)

ê°€ìƒ í™˜ê²½ì„ í™œì„±í™”í•˜ì§€ ì•Šê³  ì§ì ‘ Pythonì„ ì‹¤í–‰:
```powershell
.\venv311\Scripts\python.exe utils/CNN/defect_type_classifier.py --data-dir data/labeled_layers
```

#### ë°©ë²• 4: ì˜êµ¬ì ìœ¼ë¡œ ì‹¤í–‰ ì •ì±… ë³€ê²½ (ê´€ë¦¬ì ê¶Œí•œ í•„ìš”)

ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ PowerShellì„ ì—´ê³ :
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

ì´í›„ `.\venv311\Scripts\Activate.ps1`ë§Œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.

### ê°€ìƒ í™˜ê²½ í™œì„±í™” í™•ì¸

ê°€ìƒ í™˜ê²½ì´ í™œì„±í™”ë˜ë©´ í”„ë¡¬í”„íŠ¸ ì•ì— `(venv311)`ì´ í‘œì‹œë©ë‹ˆë‹¤:
```powershell
(venv311) PS D:\iot\FLAM>
```

Python ë²„ì „ í™•ì¸:
```powershell
python --version
```

---

## ğŸ’» ì‹¤í–‰ ê°€ì´ë“œ

### ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ (ê¶Œì¥)

```bash
# 1. ë°ì´í„° ë‹¤ìš´ë¡œë“œ
python utils/Dataset/download_labeled_layers.py --metadata

# 2. ë°ì´í„°ì…‹ ì •ë¦¬
python utils/Dataset/cleanup_dataset.py --data-dir data/labeled_layers --min-count 30

# 3. ê²°í•¨ ìœ í˜• ë¶„ì„ (ì„ íƒì‚¬í•­)
python utils/Dataset/analyze_defect_types.py --data-dir data/labeled_layers

# 4. ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ
python utils/CNN/defect_type_classifier.py \
    --data-dir data/labeled_layers \
    --epochs 20 \
    --batch-size 16 \
    --min-count 30

# 5. ëª¨ë¸ í…ŒìŠ¤íŠ¸
python utils/CNN/test_defect_type_classifier.py \
    --checkpoint checkpoints/best_model.pth \
    --data-dir data/labeled_layers
```

### í”½ì…€ ë‹¨ìœ„ ê²°í•¨ íƒì§€ (ì—°í•© í•™ìŠµ)

```python
# 1. ë°ì´í„° ì¤€ë¹„ (ì„ íƒì‚¬í•­ - MongoDBì—ì„œ ë‹¤ìš´ë¡œë“œ)
# python utils/Dataset/download_labeled_layers.py --output data/labeled_layers

# 2. ë°ì´í„°ì…‹ ìƒì„±
datasetImageDict, datasetMaskDict = create_dataset(
    clientIdentifierDict, 
    imagePath0, 
    imagePath1, 
    npyPath, 
    tileSize=128
)

# 3. í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë‚˜ëˆ„ê¸°
trainClients = ['client1', 'client2', ..., 'client7']  # 7ê°œ ê³µì¥
testClients = ['client8']                              # 1ê°œ ê³µì¥ (í…ŒìŠ¤íŠ¸ìš©)

# 4. ëª¨ë¸ ì´ˆê¸°í™”
model = initialize_unet()

# 5. ì—°í•© í•™ìŠµ ì‹œì‘
model, serverWeights, lossDict, testLoss, accuracyDict, testAccuracy = \
    federated_averaging(
        model,
        SERVER_ROUNDS=2,
        LOCAL_EPOCHS=5,
        LOCAL_BATCH_SIZE=32,
        LOCAL_LEARNING_RATE=8e-05,
        clientIDs=trainClients,
        imageDict=datasetImageDict,
        segMaskDict=datasetMaskDict,
        testImages=testImages,
        testMasks=testMasks
    )

# 6. ê²°ê³¼ ì‹œê°í™”
visualize_results_testset(
    model,
    datasetImageDict,
    datasetMaskDict,
    testClients,
    clientIdentifierDict
)

# 7. ëª¨ë¸ ë¹„êµ (ì„ íƒì‚¬í•­)
compare_results_testset(
    cl_model,  # ì¤‘ì•™í™” í•™ìŠµ ëª¨ë¸
    fl_model,  # ì—°í•© í•™ìŠµ ëª¨ë¸
    datasetImageDict,
    datasetMaskDict,
    testClients,
    clientIdentifierDict
)
```

---

## â“ ì™œ ì—°í•© í•™ìŠµì„ ì“°ë‚˜ìš”?

### ì¼ë°˜ í•™ìŠµ (Centralized Learning)
- **ë°©ì‹**: ëª¨ë“  ë°ì´í„°ë¥¼ í•œ ê³³ì— ëª¨ì•„ì„œ í•™ìŠµ
- **ë¬¸ì œì **:
  - ë°ì´í„° í”„ë¼ì´ë²„ì‹œ ì´ìŠˆ
  - ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ì†Œëª¨
  - ì¤‘ì•™ ì„œë²„ ë¶€í•˜

### ì—°í•© í•™ìŠµ (Federated Learning)
- **ë°©ì‹**: ê° ê³µì¥ì˜ ë°ì´í„°ëŠ” ê·¸ëŒ€ë¡œ ë‘ê³ , ëª¨ë¸ ê°€ì¤‘ì¹˜ë§Œ ê³µìœ 
- **ì¥ì **:
  - ë°ì´í„° í”„ë¼ì´ë²„ì‹œ ë³´í˜¸
  - ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ ê°ì†Œ (ê°€ì¤‘ì¹˜ë§Œ ì „ì†¡)
  - ë¶„ì‚° ì²˜ë¦¬ ê°€ëŠ¥
- **ë‹¨ì **:
  - í†µì‹  ì˜¤ë²„í—¤ë“œ
  - í´ë¼ì´ì–¸íŠ¸ ê°„ ë°ì´í„° ë¶ˆê· í˜• ê°€ëŠ¥

---

## ğŸ“š ì¶”ê°€ ì •ë³´

- **ë…¼ë¬¸**: Federated learning-based semantic segmentation for pixel-wise defect detection in additive manufacturing
- **ë°ì´í„°**: Laser Powder Bed Fusion (L-PBF) ì´ë¯¸ì§€
- **ëª©ì **: 3D í”„ë¦°íŒ… ê³¼ì •ì˜ ê²°í•¨ ìë™ íƒì§€
- **ë°ì´í„° ì†ŒìŠ¤**: MongoDB (ì—°ê²° ì •ë³´ëŠ” `utils/Dataset/download_labeled_layers.py`ì—ì„œ ì„¤ì •)
- **ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°**:
  - ê° ì‹¤í—˜ë§ˆë‹¤ ë³„ë„ DB (ì˜ˆ: `20210909_2131_D160`)
  - `LayersModelDB`: ë ˆì´ì–´ ë©”íƒ€ë°ì´í„° (IsLabeled í•„ë“œ í¬í•¨)
  - `{db_name}_vision`: GridFSë¡œ ì €ì¥ëœ ë¹„ì „ ì´ë¯¸ì§€

---

## ğŸ¯ ìš”ì•½

### ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸ (ìƒˆë¡œìš´ ë°©ì‹)
1. **MongoDBì—ì„œ ë ˆì´ë¸”ëœ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ** (`utils/Dataset/download_labeled_layers.py`)
2. **ë°ì´í„°ì…‹ ì •ë¦¬** - ì†Œìˆ˜ í´ë˜ìŠ¤ ë° ì˜ë¯¸ ì—†ëŠ” ì´ë¦„ ì œê±° (`utils/Dataset/cleanup_dataset.py`)
3. **ê²°í•¨ ìœ í˜• ë¶„ì„** - ë°ì´í„°ì…‹ í†µê³„ í™•ì¸ (`utils/Dataset/analyze_defect_types.py`)
4. **CNN ëª¨ë¸ í•™ìŠµ** - ê²°í•¨ ìœ í˜• ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ (`utils/CNN/defect_type_classifier.py`)
5. **ëª¨ë¸ í…ŒìŠ¤íŠ¸** - í•™ìŠµëœ ëª¨ë¸ í‰ê°€ (`utils/CNN/test_defect_type_classifier.py`)

### í”½ì…€ ë‹¨ìœ„ ê²°í•¨ íƒì§€ (ê¸°ì¡´ ë°©ì‹)
1. **MongoDBì—ì„œ ë ˆì´ë¸”ëœ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ** (`utils/Dataset/download_labeled_layers.py`)
2. **ì´ë¯¸ì§€ë¥¼ ì‘ì€ ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆ”** (128Ã—128 íƒ€ì¼) (`image_processing.py`)
3. **ê° ê³µì¥ë³„ë¡œ ë°ì´í„° ì •ë¦¬** (8ê°œ í´ë¼ì´ì–¸íŠ¸) (`dataset_functions.py`)
4. **U-Net ëª¨ë¸ ìƒì„±** (3í´ë˜ìŠ¤ ë¶„ë¥˜) (`unet.py`)
5. **ê° ê³µì¥ì—ì„œ í•™ìŠµ â†’ ì„œë²„ì—ì„œ í‰ê·  â†’ ë°˜ë³µ** (ì—°í•© í•™ìŠµ) (`federated_averaging.py`)
6. **ê²°ê³¼ í™•ì¸ ë° ì‹œê°í™”** (`visualization.py`)

---

## ğŸ”§ ì˜ì¡´ì„± íŒ¨í‚¤ì§€

```txt
# ê¸°ë³¸ íŒ¨í‚¤ì§€
numpy          # ìˆ˜ì¹˜ ì—°ì‚°
Pillow         # ì´ë¯¸ì§€ ì²˜ë¦¬
matplotlib     # ì‹œê°í™”
tqdm           # ì§„í–‰ë¥  í‘œì‹œ

# ë”¥ëŸ¬ë‹ í”„ë ˆì„ì›Œí¬
tensorflow     # U-Net ëª¨ë¸ í•™ìŠµ (ì—°í•© í•™ìŠµ)
torch          # PyTorch (ê²°í•¨ ë¶„ë¥˜ ëª¨ë¸)
torchvision    # PyTorch ë¹„ì „ ìœ í‹¸ë¦¬í‹°

# ë°ì´í„°ë² ì´ìŠ¤
pymongo        # MongoDB í´ë¼ì´ì–¸íŠ¸

# ê¸°íƒ€
requests       # HTTP ìš”ì²­ (í•„ìš”ì‹œ)
scikit-learn   # ë¨¸ì‹ ëŸ¬ë‹ ìœ í‹¸ë¦¬í‹° (í…ŒìŠ¤íŠ¸ìš©)
```

---

## ğŸ“ íŒŒì¼ë³„ í•¨ìˆ˜ ëª©ë¡

### `image_processing.py`
- `split_image()`: ì´ë¯¸ì§€ë¥¼ íƒ€ì¼ë¡œ ë¶„í• 
- `unsplit_image()`: íƒ€ì¼ì„ ì›ë³¸ ì´ë¯¸ì§€ë¡œ ë³µì›
- `unsplit_image_mask()`: íƒ€ì¼ ë§ˆìŠ¤í¬ë¥¼ ì›ë³¸ ë§ˆìŠ¤í¬ë¡œ ë³µì›
- `preprocess_image()`: ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ë° íƒ€ì¼ë§

### `dataset_functions.py`
- `create_dataset()`: í´ë¼ì´ì–¸íŠ¸ë³„ ë°ì´í„°ì…‹ ìƒì„±
- `unwrap_client_data()`: ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° ê²°í•©

### `unet.py`
- `initialize_unet()`: U-Net ëª¨ë¸ ìƒì„± ë° ì»´íŒŒì¼

### `federated_averaging.py`
- `federated_averaging()`: FedAvg ì—°í•© í•™ìŠµ ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰

### `visualization.py`
- `visualize_results_testset()`: í…ŒìŠ¤íŠ¸ì…‹ ê²°ê³¼ ì‹œê°í™”
- `compare_results_testset()`: CL vs FL ëª¨ë¸ ë¹„êµ ì‹œê°í™”

### `utils/Dataset/download_labeled_layers.py`
- `parse_args()`: ëª…ë ¹ì¤„ ì¸ì íŒŒì‹±
- `build_client()`: MongoDB í´ë¼ì´ì–¸íŠ¸ ìƒì„±
- `resolve_databases()`: ì²˜ë¦¬í•  DB ëª©ë¡ ê²°ì •
- `ensure_collections()`: ì»¬ë ‰ì…˜ í™•ì¸ ë° GridFS ìƒì„±
- `truthy_filter()`: IsLabeled í•„í„° ìƒì„±
- `doc_to_filename()`: ë¬¸ì„œë¥¼ íŒŒì¼ëª…ìœ¼ë¡œ ë³€í™˜
- `write_bytes()`: ë°”ì´íŠ¸ ë°ì´í„° ì €ì¥
- `write_metadata()`: ë©”íƒ€ë°ì´í„° JSON ì €ì¥
- `download_for_db()`: DBë³„ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
- `main()`: ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜

### `utils/Dataset/cleanup_dataset.py`
- `extract_defect_types_from_metadata()`: JSON ë©”íƒ€ë°ì´í„°ì—ì„œ ê²°í•¨ ìœ í˜• ì¶”ì¶œ
- `is_meaningless_name()`: ì˜ë¯¸ ì—†ëŠ” ì´ë¦„ í™•ì¸
- `cleanup_dataset()`: ë°ì´í„°ì…‹ ì •ë¦¬ ë° ì‚­ì œ ë©”ì¸ í•¨ìˆ˜
- `main()`: CLI ì¸í„°í˜ì´ìŠ¤

### `utils/Dataset/analyze_defect_types.py`
- `extract_defect_types_from_metadata()`: JSON ë©”íƒ€ë°ì´í„°ì—ì„œ ê²°í•¨ ìœ í˜• ì¶”ì¶œ
- `analyze_defect_dataset()`: ë°ì´í„°ì…‹ì˜ ê²°í•¨ ì¢…ë¥˜ ë¶„ì„

### `utils/CNN/defect_type_classifier.py`
- `extract_defect_types_from_metadata()`: ë©”íƒ€ë°ì´í„°ì—ì„œ ê²°í•¨ ìœ í˜• ì¶”ì¶œ
- `analyze_defect_types()`: ê²°í•¨ ìœ í˜• ë¶„ì„ ë° ë§¤í•‘ ìƒì„±
- `DefectTypeDataset`: PyTorch ë°ì´í„°ì…‹ í´ë˜ìŠ¤
- `DefectTypeClassifier`: CNN ë¶„ë¥˜ ëª¨ë¸
- `train_defect_classifier()`: ëª¨ë¸ í•™ìŠµ í•¨ìˆ˜
- `main()`: ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜

### `utils/CNN/test_defect_type_classifier.py`
- `test_model()`: ëª¨ë¸ í…ŒìŠ¤íŠ¸ ë° ì˜ˆì¸¡
- `analyze_results()`: ê²°ê³¼ ë¶„ì„ ë° í†µê³„
- `visualize_results()`: í˜¼ë™ í–‰ë ¬ ì‹œê°í™”

### `utils/AprilGAN/zero_shot_defect_classifier.py`
- `LabeledImageDataset`: ë ˆì´ë¸”ëœ ì´ë¯¸ì§€ ë°ì´í„°ì…‹
- `AprilGANGenerator`: GAN ìƒì„±ì ëª¨ë¸
- `AprilGANDiscriminator`: GAN íŒë³„ì ëª¨ë¸
- `AprilGANZeroShotClassifier`: ì œë¡œìƒ· ê²°í•¨ ë¶„ë¥˜ í´ë˜ìŠ¤
- `train()`: ëª¨ë¸ í•™ìŠµ í•¨ìˆ˜
- `main()`: ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜
