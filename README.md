# Federated Learning for Additive Manufacturing (FLAM) - 결함 검출 및 분류

## 프로젝트 개요

본 프로젝트는 2단계 파이프라인을 통해 적층 제조 공정의 결함을 검출하고 분류합니다.

## 2단계 파이프라인

### 1단계: U-Net 기반 결함 검출

- **목적**: 이미지 전체를 입력받아 결함이 있는지 없는지를 판단
- **입력**: 이미지 전체 (Post Spreading + Post Fusion 이미지)
- **출력**: 결함 존재 여부 판단 (이진 분류: 결함 있음/없음)
- **학습 데이터**: 
  - 전처리된 npy 파일 사용 (모든 결함 유형이 클래스 2로 통합됨)
  - 연합 학습(Federated Learning) 방식으로 학습

### 2단계: CNN 기반 결함 유형 분류

- **목적**: 결함이 발견된 이미지에 대해 결함 유형을 분류
- **입력**: U-Net이 결함을 발견한 이미지 전체
- **출력**: 결함 유형 분류 (다중 클래스 분류)
- **학습 데이터**:
  - U-Net이 결함을 발견한 이미지만 사용
  - 원본 npy 파일(전처리 전)에서 결함 유형 숫자 값들을 확인
  - 각 이미지의 npy 파일에서 가장 많이 나타나는 결함 유형 숫자를 해당 이미지의 레이블로 사용
  - 예: 이미지 A의 npy 파일에 `[2, 2, 2, 3, 3, 4]`가 있다면, `2`가 3번으로 가장 많으므로 이미지 A의 레이블은 `2`

## 핵심 포인트

1. **결함 영역 추출 불필요**: 결함 영역을 개별적으로 추출하지 않고, 이미지 전체를 CNN에 입력
2. **이미지 단위 분류**: 각 이미지 전체를 하나의 샘플로 사용하여 결함 유형을 분류
3. **레이블 생성 방법**: 원본 npy 파일의 결함 유형 숫자 값들의 빈도를 계산하여 가장 빈번한 결함 유형을 선택

## 워크플로우

1. **U-Net 학습**: 전처리된 데이터로 U-Net 모델 학습 (결함 검출)
2. **결함 검출**: U-Net으로 모든 이미지에 대해 결함 존재 여부 판단
3. **데이터셋 구성**: 결함이 발견된 이미지만 선별
4. **레이블 생성**: 각 이미지의 원본 npy 파일에서 결함 유형 숫자 값들의 빈도 분석 → 가장 많은 결함 유형을 레이블로 선택
5. **CNN 학습**: 선별된 이미지와 생성된 레이블로 CNN 모델 학습 (결함 유형 분류)
6. **결함 유형 분류**: 학습된 CNN 모델로 결함 유형 분류 수행
